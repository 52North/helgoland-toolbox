<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>helgoland-toolbox documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	      <link rel="stylesheet" href="../styles/style.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">helgoland-toolbox documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content interface">
                   <div class="content-data">












<ol class="breadcrumb">
  <li>Interfaces</li>
  <li>AdditionalData</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>libs/d3/src/lib/extended-data-d3-timeseries-graph/extended-data-d3-timeseries-graph.component.ts</code>
        </p>

            <p class="comment">
                <h3>Description</h3>
            </p>
            <p class="comment">
                <p>Additional Data which can be add to the component <a href="../components/ExtendedDataD3TimeseriesGraphComponent.html">ExtendedDataD3TimeseriesGraphComponent</a> as Input.
One of the optional properties &#39;linkedDatasetId&#39; and &#39;yaxisLabel&#39; is mandatory.</p>

            </p>


        <section>
            <h3 id="index">Index</h3>
            <table class="table table-sm table-bordered index-table">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <h6><b>Properties</b></h6>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <ul class="index-list">
                                <li>
                                        <a href="#data">data</a>
                                </li>
                                <li>
                                            <span class="modifier">Optional</span>
                                        <a href="#datasetOptions">datasetOptions</a>
                                </li>
                                <li>
                                        <a href="#internalId">internalId</a>
                                </li>
                                <li>
                                            <span class="modifier">Optional</span>
                                        <a href="#linkedDatasetId">linkedDatasetId</a>
                                </li>
                                <li>
                                            <span class="modifier">Optional</span>
                                        <a href="#yaxisLabel">yaxisLabel</a>
                                </li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>



            <section>
                <h3 id="inputs">Properties</h3>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="data"></a>
                                        <span class="name"><b>data</b><a href="#data"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>data:     <code>AdditionalDataEntry[]</code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code>AdditionalDataEntry[]</code>

                                        </td>
                                    </tr>





                            <tr>
                                <td class="col-md-4">
                                    <div class="io-description"><p>The additional data arrey with tupels of timestamp and value.</p>
</div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="datasetOptions"></a>
                                        <span class="name"><b>datasetOptions</b><a href="#datasetOptions"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>datasetOptions:         <code><a href="../interfaces/Data.html" target="_self" >DatasetOptions</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="../interfaces/Data.html" target="_self" >DatasetOptions</a></code>

                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="col-md-4">
                                            <i>Optional</i>
                                        </td>
                                    </tr>




                            <tr>
                                <td class="col-md-4">
                                    <div class="io-description"><p>The dataset options, which describes the styling of the additional data.</p>
</div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="internalId"></a>
                                        <span class="name"><b>internalId</b><a href="#internalId"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>internalId:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                            <tr>
                                <td class="col-md-4">
                                    <div class="io-description"><p>Internal Id connected with the dataset options</p>
</div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="linkedDatasetId"></a>
                                        <span class="name"><b>linkedDatasetId</b><a href="#linkedDatasetId"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>linkedDatasetId:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="col-md-4">
                                            <i>Optional</i>
                                        </td>
                                    </tr>




                            <tr>
                                <td class="col-md-4">
                                    <div class="io-description"><p>Linked to an existing dataset in the graph component and uses it dataset options if no other datasetoptions are presented.</p>
</div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="yaxisLabel"></a>
                                        <span class="name"><b>yaxisLabel</b><a href="#yaxisLabel"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>yaxisLabel:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="col-md-4">
                                            <i>Optional</i>
                                        </td>
                                    </tr>




                            <tr>
                                <td class="col-md-4">
                                    <div class="io-description"><p>Y-Axis label if no link to an existing dataset is given.</p>
</div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
            </section>
    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import {
  AfterViewInit,
  Component,
  DoCheck,
  Input,
  IterableDiffer,
  IterableDiffers,
  OnInit,
  ViewEncapsulation,
} from &#x27;@angular/core&#x27;;
import {
  ColorService,
  DatasetOptions,
  HelgolandServicesConnector,
  InternalIdHandler,
  SumValuesService,
  Time,
  TimezoneService,
} from &#x27;@helgoland/core&#x27;;
import { TranslateService } from &#x27;@ngx-translate/core&#x27;;

import { D3TimeseriesGraphComponent } from &#x27;../d3-timeseries-graph/d3-timeseries-graph.component&#x27;;
import { D3GraphHelperService } from &#x27;../helper/d3-graph-helper.service&#x27;;
import { D3GraphId } from &#x27;../helper/d3-graph-id.service&#x27;;
import { D3TimeFormatLocaleService } from &#x27;../helper/d3-time-format-locale.service&#x27;;
import { InternalDataEntry } from &#x27;../model/d3-general&#x27;;
import { D3Graphs } from &#x27;./../helper/d3-graphs.service&#x27;;
import { RangeCalculationsService } from &#x27;./../helper/range-calculations.service&#x27;;

/**
 * Additional Data which can be add to the component {@link ExtendedDataD3TimeseriesGraphComponent} as Input.
 * One of the optional properties &#x27;linkedDatasetId&#x27; and &#x27;yaxisLabel&#x27; is mandatory.
 */
export interface AdditionalData {
  /**
   * Linked to an existing dataset in the graph component and uses it dataset options if no other datasetoptions are presented.
   */
  linkedDatasetId?: string;
  /**
   * Y-Axis label if no link to an existing dataset is given.
   */
  yaxisLabel?: string;
  /**
   * The dataset options, which describes the styling of the additional data.
   */
  datasetOptions?: DatasetOptions;
  /**
   * Internal Id connected with the dataset options
   */
  internalId: string;
  /**
   * The additional data arrey with tupels of timestamp and value.
   */
  data: AdditionalDataEntry[];
}

/**
 * Additional data entry tuple
 */
export interface AdditionalDataEntry {
  timestamp: number;
  value: number;
}

/**
 * Extends the common d3 component, with the ability to add additional data to the graph. To set or change  additional data, allways sets the complete array of data new. The componet just redraws if
 * the array is reset.
 */
@Component({
  selector: &#x27;n52-extended-data-d3-timeseries-graph&#x27;,
  templateUrl: &#x27;../d3-timeseries-graph/d3-timeseries-graph.component.html&#x27;,
  styleUrls: [&#x27;../d3-timeseries-graph/d3-timeseries-graph.component.scss&#x27;],
  providers: [D3GraphId],
  encapsulation: ViewEncapsulation.None
})
export class ExtendedDataD3TimeseriesGraphComponent extends D3TimeseriesGraphComponent implements DoCheck, AfterViewInit, OnInit {

  @Input()
  public additionalData: AdditionalData[] &#x3D; [];
  private additionalDataDiffer: IterableDiffer&lt;AdditionalData&gt;;

  constructor(
    protected iterableDiffers: IterableDiffers,
    protected datasetIdResolver: InternalIdHandler,
    protected timeSrvc: Time,
    protected timeFormatLocaleService: D3TimeFormatLocaleService,
    protected colorService: ColorService,
    protected translateService: TranslateService,
    protected timezoneSrvc: TimezoneService,
    protected sumValues: SumValuesService,
    protected rangeCalc: RangeCalculationsService,
    protected graphHelper: D3GraphHelperService,
    protected graphService: D3Graphs,
    protected graphId: D3GraphId,
    protected servicesConnector: HelgolandServicesConnector
  ) {
    super(
      iterableDiffers,
      datasetIdResolver,
      timeSrvc,
      timeFormatLocaleService,
      colorService,
      translateService,
      timezoneSrvc,
      sumValues,
      rangeCalc,
      graphHelper,
      graphService,
      graphId,
      servicesConnector
    );
  }

  public ngOnInit(): void {
    this.additionalDataDiffer &#x3D; this.iterableDiffers.find(this.additionalData).create();
  }

  public ngDoCheck() {
    super.ngDoCheck();
    const additionalDataChanges &#x3D; this.additionalDataDiffer.diff(this.additionalData);
    if (additionalDataChanges &amp;&amp; this.additionalData &amp;&amp; this.graph) {
      additionalDataChanges.forEachRemovedItem((removedItem) &#x3D;&gt; {
        const id &#x3D; this.generateAdditionalInternalId(removedItem.item);
        const spliceIdx &#x3D; this.preparedData.findIndex((entry) &#x3D;&gt; entry.internalId &#x3D;&#x3D;&#x3D; id);
        if (spliceIdx &gt;&#x3D; 0) {
          this.preparedData.splice(spliceIdx, 1);
        }
      });
      this.redrawCompleteGraph();
    }
  }

  public redrawCompleteGraph() {
    this.prepareAdditionalData();
    super.redrawCompleteGraph();
  }

  public ngAfterViewInit(): void {
    super.ngAfterViewInit();
  }

  protected timeIntervalChanges(): void {
    if (this.datasetMap.size &gt; 0) {
      super.timeIntervalChanges();
    } else {
      this.redrawCompleteGraph();
    }
  }

  protected prepareYAxes() {
    super.prepareYAxes();
    this.additionalData.forEach(entry &#x3D;&gt; {
      const id &#x3D; this.generateAdditionalInternalId(entry);
      this.createYAxisForId(id);
    });
  }

  private prepareAdditionalData() {
    if (this.additionalData) {
      this.additionalData.forEach(entry &#x3D;&gt; {
        if ((entry.linkedDatasetId || entry.yaxisLabel) &amp;&amp; entry.data &amp;&amp; entry.data.length &gt; 0) {

          const options &#x3D; entry.datasetOptions || this.datasetOptions.get(entry.linkedDatasetId);
          const dataset &#x3D; this.datasetMap.get(entry.linkedDatasetId);
          const prepDataIdx &#x3D; this.preparedData.findIndex(e &#x3D;&gt; e.internalId.indexOf(entry.linkedDatasetId) &gt; -1 || e.internalId.indexOf(entry.internalId) &gt; -1);
          let dataEntry: InternalDataEntry;
          if (prepDataIdx &#x3D;&#x3D;&#x3D; -1) {
            dataEntry &#x3D; {
              internalId: this.generateAdditionalInternalId(entry),
              hoverId: &#x60;hov-${Math.random().toString(36).substr(2, 9)}&#x60;,
              options,
              data: options.visible ? entry.data.map(e &#x3D;&gt; ({ timestamp: e.timestamp, value: e.value })) : [],
              axisOptions: {
                uom: dataset ? dataset.uom : entry.yaxisLabel,
                label: dataset ? dataset.label : entry.yaxisLabel,
                zeroBased: options.zeroBasedYAxis,
                yAxisRange: options.yAxisRange,
                autoRangeSelection: options.autoRangeSelection,
                separateYAxis: options.separateYAxis
              },
              referenceValueData: [],
              visible: options.visible
            };
            if (dataset) {
              dataEntry.axisOptions.parameters &#x3D; {
                feature: dataset.parameters.feature,
                phenomenon: dataset.parameters.phenomenon,
                offering: dataset.parameters.offering
              };
            }
            this.preparedData.push(dataEntry);
          } else {
            dataEntry &#x3D; this.preparedData[prepDataIdx];
            dataEntry.axisOptions.uom &#x3D; dataset ? dataset.uom : entry.yaxisLabel;
            dataEntry.axisOptions.label &#x3D; dataset ? dataset.label : entry.yaxisLabel;
            dataEntry.data &#x3D; options.visible ? entry.data.map(e &#x3D;&gt; ({ timestamp: e.timestamp, value: e.value })) : [];
          }

          this.processData(dataEntry);

        } else {
          console.warn(&#x27;Please check the additional entry, it needs at least a \&#x27;linkedDatasetId\&#x27; or a \&#x27;yaxisLabel\&#x27; property and a \&#x27;data\&#x27; property: &#x27;, entry);
        }
      });
    }
  }


  private generateAdditionalInternalId(entry: AdditionalData): string {
    return entry.linkedDatasetId ? entry.linkedDatasetId + &#x27;add&#x27; : entry.internalId + &#x27;add&#x27;;
  }
}
</code></pre>
    </div>
</div>


                   




                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> result-matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'interface';
            var COMPODOC_CURRENT_PAGE_URL = 'AdditionalData.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>
       <!-- Required to polyfill modern browsers as code is ES5 for IE... -->
       <script src="../js/libs/custom-elements-es5-adapter.js" charset="utf-8" defer></script>
       <script src="../js/menu-wc.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
