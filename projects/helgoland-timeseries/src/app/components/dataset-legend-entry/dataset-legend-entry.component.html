<mat-expansion-panel [ngStyle]="{'border-color': dataset?.style.baseColor}" [expanded]="true">
  <mat-expansion-panel-header>
    <mat-panel-title>
      <div class="title" [ngClass]="{'noData': !hasData}" *ngIf="!error">
        <n52-label-mapper label="{{dataset.description.phenomenonLabel}}"></n52-label-mapper>
        <span *ngIf="dataset.description.uom">
          <span> [<n52-label-mapper label="{{dataset.description.uom}}"></n52-label-mapper>] </span>
        </span>
        <div>{{dataset.description.platformLabel}}</div>
      </div>
      <div class="title error" *ngIf="error">
        Error occured, while loading {{dataset.id}}
      </div>
      <div style="flex: 1"></div>
      <button mat-icon-button (click)="removeDataset(); $event.stopPropagation()"
        attr.aria-label="{{'legend-entry.remove-entry-button.tooltip' | translate}}"
        matTooltip="{{'legend-entry.remove-entry-button.tooltip' | translate}}">
        <mat-icon>clear</mat-icon>
      </button>
    </mat-panel-title>
  </mat-expansion-panel-header>
  <div *ngIf="!error">
    <div class="small-label" *ngIf="dataset.description.procedureLabel || dataset.description.categoryLabel">
      <n52-label-mapper label="{{dataset.description.procedureLabel}}"></n52-label-mapper>
      <span *ngIf="dataset.description.categoryLabel !== dataset.description.phenomenonLabel">
        - <n52-label-mapper label="{{dataset.description.categoryLabel}}"></n52-label-mapper>
      </span>
    </div>
    <div class="controls">
      <button mat-icon-button (click)="toggleSelection(); $event.stopPropagation()"
        attr.aria-label="{{'legend-entry.toggle-selection-button.tooltip' | translate}}"
        matTooltip="{{'legend-entry.toggle-selection-button.tooltip' | translate}}">
        <mat-icon *ngIf="!dataset.selected">check_box_outline_blank</mat-icon>
        <mat-icon *ngIf="dataset.selected">check_box</mat-icon>
      </button>
      <button mat-icon-button (click)="toggleVisibility(); $event.stopPropagation()"
        attr.aria-label="{{'legend-entry.toggle-visibility-button.tooltip' | translate}}"
        matTooltip="{{'legend-entry.toggle-visibility-button.tooltip' | translate}}">
        <mat-icon>{{dataset?.visible ? 'visibility' : 'visibility_off'}}</mat-icon>
      </button>
      <button mat-icon-button (click)="editDatasetOptions(); $event.stopPropagation()"
        attr.aria-label="{{'legend-entry.edit-dataset-button.tooltip' | translate}}"
        matTooltip="{{'legend-entry.edit-dataset-button.tooltip' | translate}}">
        <helgoland-timeseries-entry-symbol [datasetStyle]="dataset?.style" [size]="40"
          style="height: 40px; width: 40px; display: inline-block;">
        </helgoland-timeseries-entry-symbol>
      </button>
      <helgoland-favorite-toggle-button [dataset]="dataset"> </helgoland-favorite-toggle-button>
    </div>
    <div class="entry-line clickable" *ngIf="dataset.description.firstValue"
      (click)="jumpToFirstTimeStamp(); $event.stopPropagation();">
      <span>{{'diagram-view.legend.entry.first-value-at' | translate}}: </span>
      <span> {{dataset.description.firstValue.timestamp | date: 'short': null : translateSrvc.currentLang}} </span>
      <span>({{dataset.description.firstValue.value}} {{dataset.description.uom}})</span>
    </div>
    <div class="entry-line clickable" *ngIf="dataset.description.lastValue"
      (click)="jumpToLastTimeStamp(); $event.stopPropagation();">
      <span>{{'diagram-view.legend.entry.last-value-at' | translate}}: </span>
      <span> {{dataset.description.lastValue.timestamp | date: 'short' : null : translateSrvc.currentLang}} </span>
      <span>({{dataset.description.lastValue.value}} {{dataset.description.uom}})</span>
    </div>
    <div *ngIf="dataset?.children?.length > 0">
      <div>{{'diagram-view.legend-reference-values' | translate}}: </div>
      <div *ngFor="let child of dataset.children">
        <mat-slide-toggle [checked]="child.visible" color="primary" (change)="child.setVisible($event.checked)">
          <span [ngStyle]="{color: child.color}">{{child.label}}</span>
        </mat-slide-toggle>
      </div>
    </div>
  </div>
  <helgoland-loading-overlay-progress-bar *ngIf="dataset.dataLoading"></helgoland-loading-overlay-progress-bar>
</mat-expansion-panel>
