<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>helgoland-toolbox documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../../images/favicon.ico">
	      <link rel="stylesheet" href="../../styles/style.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../../" class="navbar-brand">helgoland-toolbox documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content additional-page">
                   <div class="content-data">














                   




<h1 id="how-to-integrate-a-d3-timeseries-component">How to Integrate a D3 timeseries component</h1>
<p>In this tutorial a stepwise instruction will be given on how to integrate a D3 timeseries component into an angular app (ng-app).</p>
<p>First initialize an app as described in the prepare section <a href="../how-tos.html">here</a> or integrate this component in an existing project.</p>
<h2 id="step-1-import-helgoland-dependencies">Step 1: import helgoland dependencies</h2>
<p>To start working with the helgoland D3 component a few dependencies are needed: <a href="https://www.npmjs.com/package/@helgoland/d3">helgoland-d3</a> and <a href="https://www.npmjs.com/package/@helgoland/core">helgoland-core</a> are necessary to provide the D3 timeseries component, in detail, to visualize the diagram containing the dataset graphs and to get accesss via the dataset API. For translations <a href="http://www.ngx-translate.com/">ngx-translate</a> is used and the <a href="https://www.npmjs.com/package/@ngx-translate/http-loader">ngx-translate-http-loader</a> will load the translations.</p>
<table class="table table-bordered compodoc-table">
<thead>
<tr>
<th>Install dependencies</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>npm i @helgoland/core</code></td>
</tr>
<tr>
<td><code>npm i @helgoland/d3</code></td>
</tr>
<tr>
<td><code>npm i @ngx-translate/http-loader</code></td>
</tr>
</tbody>
</table>
<p>Import dependencies to your ng-app by adding the following javascript code to <code>src/app/app.module.ts</code>:</p>
<div><pre class="line-numbers"><code class="language-javascript">// Add dependencies for helgoland components.
import { HelgolandD3Module } from &#39;&#64;helgoland/d3&#39;;
import { DatasetApiInterface, SplittedDataDatasetApiInterface } from &#39;&#64;helgoland/core&#39;;

// Add dependencies for translations.
import { HttpClient } from &#39;&#64;angular/common/http&#39;;
import { TranslateLoader, TranslateModule } from &#39;&#64;ngx-translate/core&#39;;
import { TranslateHttpLoader } from &#39;&#64;ngx-translate/http-loader&#39;;</code></pre></div><p>Another step is to add the dependencies correctly to the <code>@NgModule</code>. As imports we will define the <code>TranslateModule</code> and the <code>HelgolandD3Module</code> and as providers we need to take the <code>DatasetApiInterface</code> with the <code>SplittedDataDatasetApiInterface</code> as <code>useClass</code>. To use the translation functions we will add a function called <code>HttpLoaderFactory</code> which is to be exported.
You can compare your <code>src/app/app.module.ts</code> file with the following code below:</p>
<div><pre class="line-numbers"><code class="language-javascript">&#64;NgModule({
  declarations: [
    AppComponent
  ],
  imports: [
    BrowserModule,
    TranslateModule.forRoot({
      loader: {
        provide: TranslateLoader,
        useFactory: HttpLoaderFactory,
        deps: [HttpClient]
      }
    }),
    HelgolandD3Module
  ],
  providers: [
    {
      provide: DatasetApiInterface,
      useClass: SplittedDataDatasetApiInterface
    }
  ],
  bootstrap: [AppComponent]
})
export class AppModule { }

export function HttpLoaderFactory(http: HttpClient) {
  return new TranslateHttpLoader(http);
}</code></pre></div><h3 id="suggestions-for-error-handling">Suggestions for error handling</h3>
<ul>
<li><code>Cannot find namespace &#39;GeoJSON&#39;</code> see below</li>
</ul>
<p>By manually adapting the configuration in <code>src/tsconfig.app.js</code> this issue should be solved. But to let the changes be accepted, the app has to be restarted (by executing <code>ng serve</code>). Add to the types-array the type <code>geojson</code> which then should look like this:</p>
<div><pre class="line-numbers"><code class="language-json">{
  &quot;extends&quot;: &quot;../tsconfig.json&quot;,
  &quot;compilerOptions&quot;: {
    &quot;outDir&quot;: &quot;../out-tsc/app&quot;,
    &quot;baseUrl&quot;: &quot;./&quot;,
    &quot;module&quot;: &quot;es2015&quot;,
    &quot;types&quot;: [&quot;geojson&quot;]
  },
  &quot;exclude&quot;: [
    &quot;test.ts&quot;,
    &quot;**/*.spec.ts&quot;
  ]
}</code></pre></div><h2 id="step-2-add-code">Step 2: add code</h2>
<p>Now we will integrate the directive of the D3 timeseries component. Implement the directive of the graph by adding the following code to <code>src/app/app.component.html</code>. All fields in the <code>n52-d3-timeseries-graph</code>-directive are required to provide options, datasets and other information.
Every other code that was generated by the app creation is not necessary to run the D3 timeseries component. This can be deleted or kept for further coding.</p>
<div><pre class="line-numbers"><code class="language-html">&lt;div&gt;
  &lt;n52-d3-timeseries-graph [datasetIds]=&quot;datasetIdsMultiple&quot; [selectedDatasetIds]=&quot;selectedIds&quot; [datasetOptions]=&quot;datasetOptionsMultiple&quot; [timeInterval]=&quot;timespan&quot; (onTimespanChanged)=&quot;timespanChanged($event)&quot; [graphOptions]=&quot;diagramOptionsD3&quot;&gt;&lt;/n52-d3-timeseries-graph&gt;
&lt;/div&gt;</code></pre></div><ul>
<li>Optional the style can be adapted by adding a css style modification to the directive. For example the following code will change the size:  </li>
</ul>
<div><pre class="line-numbers"><code class="language-html">&lt;div style=&quot;height: 500px; width: 100%;&quot;&gt;&lt;/div&gt;</code></pre></div><p>This code is implemented in the helgoland-toolbox github repository and can be viewed <a href="https://github.com/52North/helgoland-toolbox/blob/master/src/demo/app/pages/timeseries-graph/timeseries-graph.component.html">here</a>.</p>
<p>Implement the functionality of the <code>n52-d3-timeseries-graph</code>-directive by adding the following code to the class <code>AppComponent</code> in <code>src/app/app.component.ts</code>:</p>
<ul>
<li>Attention: If you would like to have pre-selected colors for your graph, you can change and add the color as string in the array of the variable <code>colors</code>. If you do not provide any color-entries in the array or not enough color-entries with this array, all missing colors will be randomly generated in the D3 timeseries component, because each graph needs an own color-entry.</li>
</ul>
<div><pre class="line-numbers"><code class="language-javascript">// These variables define the links for accessing the datasets and in which colors they are styled.
public datasetIdsMultiple = [&#39;https://www.fluggs.de/sos2/api/v1/__63&#39;, &#39;https://www.fluggs.de/sos2/api/v1/__72&#39;];
public colors = [&#39;#123456&#39;, &#39;#FF0000&#39;];

// The timespan will be set to the last 28 hours which is calculated in milliseconds (milliseconds*1000 = 100000000).
public timespan = new Timespan(new Date().getTime() - 100000000, new Date().getTime());

// These are the plotting options. The boolen of &#39;togglePanZoom&#39; is set to &#39;true&#39; to pan the graph.
public diagramOptionsD3: D3PlotOptions = {
    togglePanZoom: true,
    showReferenceValues: false,
    generalizeAllways: true
};

// &#39;selectedIds&#39; determines the graphs that are visualized with a larger stroke-width. This can be set by clicking on the y-axis.
public selectedIds: string[] = [];
public datasetOptionsMultiple: Map&lt;string, DatasetOptions&gt; = new Map();

constructor() {
    this.datasetIdsMultiple.forEach((entry, i) =&gt; {
        this.datasetOptionsMultiple.set(entry, new DatasetOptions(entry, this.colors[i]));
    });
}

// This function changes the timespan of the graph which is needed for panning (and zooming).
public timespanChanged(timespan: Timespan) {
    this.timespan = timespan;
}</code></pre></div><p>This code is implemented in the helgoland-toolbox github repository and can be viewed <a href="https://github.com/52North/helgoland-toolbox/blob/master/src/demo/app/pages/timeseries-graph/timeseries-graph.component.ts">here</a>.</p>
<p><strong>A very important step should not be missed</strong><br>To use the functionality of the functions in the <code>src/app/app.component.ts</code> we need to add the dependencies to use for example <code>Timespan</code> and <code>D3PlotOptions</code>. This is done by using the following imports:</p>
<div><pre class="line-numbers"><code class="language-javascript">import { DatasetOptions, Timespan } from &#39;&#64;helgoland/core&#39;;
import { D3PlotOptions } from &#39;&#64;helgoland/d3&#39;;</code></pre></div><h2 id="step-3-start-working">Step 3: start working</h2>
<p>Now, that we have added all dependencies and the code to access the functionality of the D3 timeseries component you can start working on your app. If you did not run the app while following this tutorial you should now see the timeseries graph by starting your app with <code>ng serve</code>.</p>
<h3 id="additional-options">Additional Options</h3>
<h4 id="add-initial-min-max-value-for-y-axis">Add initial min, max value for y axis</h4>
<p>It is possible to emit a min and max value for the y-axis with the DatasetOptions for each dataset. With these values, the y-axis will only show the selected y-range. Some restrictions are:</p>
<ul>
<li>If there is no data provided in the selected timerange and y-axis min/max values, the default min and max range will be used.</li>
<li>If the y-axis min and max values are equal, the default min and max range will be used.</li>
</ul>
<h4 id="zero-based-y-axis">Zero-based y axis</h4>
<p>It is possible to set a boolean in the DatasetOptions (<code>zeroBasedYAxis</code>) to show the y axis with minimum as 0, if the data in the selected timerange is above 0, or maximum 0, if the data in the selected timerange is below 0.</p>

                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> result-matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 2;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'additional-page';
            var COMPODOC_CURRENT_PAGE_URL = 'integrate-a-d3-timeseries-component.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../../js/libs/custom-elements.min.js"></script>
       <script src="../../js/libs/lit-html.js"></script>
       <!-- Required to polyfill modern browsers as code is ES5 for IE... -->
       <script src="../../js/libs/custom-elements-es5-adapter.js" charset="utf-8" defer></script>
       <script src="../../js/menu-wc.js" defer></script>

       <script src="../../js/libs/bootstrap-native.js"></script>

       <script src="../../js/libs/es6-shim.min.js"></script>
       <script src="../../js/libs/EventDispatcher.js"></script>
       <script src="../../js/libs/promise.min.js"></script>
       <script src="../../js/libs/zepto.min.js"></script>

       <script src="../../js/compodoc.js"></script>

       <script src="../../js/tabs.js"></script>
       <script src="../../js/menu.js"></script>
       <script src="../../js/libs/clipboard.min.js"></script>
       <script src="../../js/libs/prism.js"></script>
       <script src="../../js/sourceCode.js"></script>
          <script src="../../js/search/search.js"></script>
          <script src="../../js/search/lunr.min.js"></script>
          <script src="../../js/search/search-lunr.js"></script>
          <script src="../../js/search/search_index.js"></script>
       <script src="../../js/lazy-load-graphs.js"></script>


    </body>
</html>
